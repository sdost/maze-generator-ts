<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
</head>
<body>
<canvas id="cnvs" height="480" width="640"></canvas>
<form>
  <label for="maze_width">Maze Width</label>
  <input id="maze_width" type="text" value="30" />
  <label for="maze_height">Maze Height</label>
  <input id="maze_height" type="text" value="30" />
  <label for="maze_seed">Seed</label>
  <input id="maze_seed" type="text" value="1" />
  <input id="generate" type="button" value="Generate Maze"/>
  <input id="solve" type="button" value="Solve Maze" />
</form>
<script>
var canvas = document.getElementById('cnvs');
var context = canvas.getContext("2d");
var generate = document.getElementById('generate');
var solve = document.getElementById('solve');
var width = document.getElementById('maze_width');
var height = document.getElementById('maze_height');
var seed = document.getElementById('maze_seed');
window.addEventListener('resize', resizeCanvas, false);
resizeCanvas();
if(window.Worker) {
  var worker = new Worker("worker.js");
  generate.onclick = function() {
    generate.value = "Loading...";
    generate.enabled = false;
    var data = context.createImageData(canvas.width, canvas.height);
    worker.postMessage({ action: "gen_maze", values: { width: width.value, height: height.value, seed: seed.value, imageData: data } });
  };
  solve.onclick = function() {
    solve.value = "Loading...";
    solve.enabled = false;
    var data = context.createImageData(canvas.width, canvas.height);
    worker.postMessage({ action: "solve_maze", values: { imageData: data } });
  };
  worker.onmessage = function(e) {
    generate.value = "Generate Maze";
    generate.enabled = true;
    solve.value = "Solve Maze";
    solve.enabled = true;
    context.putImageData(e.data, 0, 0);
  };
}

function resizeCanvas() {
  canvas.width = window.innerWidth - 60;
  canvas.height = window.innerHeight - 60;

  if(worker) {
    var data = context.createImageData(canvas.width, canvas.height);
    worker.postMessage({ action: "render", values: { imageData: data } });
  }
}
</script>
</body>
</html>
